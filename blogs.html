---
layout: default
title : Blogs
body_attr: >-
  data-spy="scroll" data-target="#navbar-year" data-offset="100"
---

{% assign pubs_by_year = site.blogs | where: "show", true | sort: "date" | reverse | group_by_exp: "item", "item.date | date: '%Y-%m'" %}

<div class="row">
    <div class="col-12 col-lg-10">
        {% for year in pubs_by_year %}
        {% assign num_papers = year.items | size %}
        <h2 class="pt-4" id="year-{{ year.name }}">{{ year.name }}</h2>
        <div class="my-0 p-0 bg-white shadow-sm rounded-xl">
            {% for item in year.items %}
                {% include widgets/blog_item.html item=item hide_bottom_border=forloop.last first=forloop.first last=forloop.last %}
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <div class="col-2 d-none d-lg-block">
        <div id="navbar-year" class="nav nav-pills flex-column sticky-top" style="top: 80px">
            {% for year in pubs_by_year %}
            <a class="nav-link d-block" href="#year-{{ year.name}}">{{ year.name | split: '-' | first }}-{{ year.name | split: '-' | last }}</a>
            {% endfor %}
        </div>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cardStates = new Map();
    
    // 初始化所有卡片状态
    function initializeCardStates() {
        document.querySelectorAll('.card').forEach(card => {
            const cardId = card.dataset.itemId || 'default';
            const langBtn = card.querySelector('.lang-btn');
            
            // 检查是否有语言切换按钮（即 engav 是否为 true）
            if (langBtn) {
                const engav = langBtn.dataset.engav === 'true';
                // 根据 engav 值设置正确的初始状态
                cardStates.set(cardId, {
                    isExpanded: false,
                    isEnglish: engav  // engav 为 true 时 isEnglish 也为 true
                });
                
                // 调试信息（可选）
                console.log(`Card ${cardId}: engav=${engav}, isEnglish=${engav}`);
            } else {
                // 没有语言切换按钮的卡片，默认中文状态
                cardStates.set(cardId, {
                    isExpanded: false,
                    isEnglish: false
                });
            }
        });
    }
    
    initializeCardStates();
    
    // 事件委托：处理语言切换按钮点击
    document.addEventListener('click', function(event) {
        if (event.target.classList.contains('lang-btn')) {
            const card = event.target.closest('.card');
            const langBtn = event.target;
            
            // 检查 engav 是否为 true
            const engav = langBtn.dataset.engav === 'true';
            if (!engav) return;
            
            const mainTitle = card.querySelector('.main-title');
            const textElement = card.querySelector('.text-content');
            const readMoreBtn = card.querySelector('.read-more-btn');
            const cardId = card.dataset.itemId || 'default';
            
            const state = cardStates.get(cardId);
            
            // 切换语言状态
            state.isEnglish = !state.isEnglish;
            const lang = state.isEnglish ? 'en' : 'zh';
            
            console.log(`切换语言: cardId=${cardId}, isEnglish=${state.isEnglish}, lang=${lang}`); // 调试信息
            
            // 获取翻译内容
            const titleZh = mainTitle.dataset.zh || mainTitle.textContent;
            const titleEn = mainTitle.dataset.en || titleZh;
            const contentZh = textElement.dataset.zh || textElement.innerHTML;
            const contentEn = textElement.dataset.en || contentEn;
            
            const translations = {
                'main-title': { 'zh': titleZh, 'en': titleEn },
                'text-content': { 'zh': contentZh, 'en': contentEn },
                'read-more': { 'zh': '展开', 'en': 'Read More' },
                'read-less': { 'zh': '收起', 'en': 'Read Less' },
                'lang-btn': { 'zh': 'English', 'en': '中文' }
            };
            
            // 更新内容
            mainTitle.textContent = translations['main-title'][lang];
            textElement.innerHTML = translations['text-content'][lang];
            langBtn.textContent = translations['lang-btn'][lang];
            
            // 更新阅读更多按钮文本
            if (state.isExpanded) {
                readMoreBtn.textContent = translations['read-less'][lang];
            } else {
                readMoreBtn.textContent = translations['read-more'][lang];
            }
            
            // 重新应用展开/收起状态
            const fadeElement = card.querySelector('.fade-out');
            if (state.isExpanded) {
                textElement.classList.remove('collapsed');
                if (fadeElement) fadeElement.classList.add('hidden');
            } else {
                textElement.classList.add('collapsed');
                if (fadeElement) fadeElement.classList.remove('hidden');
            }
        }
    });
    
    // 阅读更多按钮的事件委托保持不变
    document.addEventListener('click', function(event) {
        if (event.target.classList.contains('read-more-btn')) {
            const card = event.target.closest('.card');
            const textElement = card.querySelector('.text-content');
            const fadeElement = card.querySelector('.fade-out');
            const readMoreBtn = event.target;
            const cardId = card.dataset.itemId || 'default';
            
            const state = cardStates.get(cardId);
            state.isExpanded = !state.isExpanded;
            
            if (state.isExpanded) {
                textElement.classList.remove('collapsed');
                if (fadeElement) fadeElement.classList.add('hidden');
                readMoreBtn.textContent = state.isEnglish ? 'Read Less' : '收起';
                readMoreBtn.classList.add('expanded');
            } else {
                textElement.classList.add('collapsed');
                if (fadeElement) fadeElement.classList.remove('hidden');
                readMoreBtn.textContent = state.isEnglish ? 'Read More' : '展开';
                readMoreBtn.classList.remove('expanded');
            }
        }
    });
});
</script>
